{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.1",
  "parameters": {
    "location": {
      "type": "string"
    },
    "resourceGroupName": {
      "type": "string"
    },
    "todoTasksPlanName": {
      "type": "string",
      "minLength": 1
    },
    "todoTasksPlanSkuName": {
      "type": "string"
    },
    "todoTasksPlanSkuCode": {
      "type": "string"
    },
    "todoTasksAPIName": {
      "type": "string"
    },
    "alwaysOn": {
      "type": "bool"
    },
    "subscriptionId": {
      "type": "string"
    },
    "hostingEnvironment": {
      "type": "string"
    },
    "currentStack": {
      "type": "string"
    }

  },
  "variables": {},
  "resources": [ 
    {
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2018-05-01",
      "name": "resourceDeployment",
      "resourceGroup": "[resourceGroup().name]",
      "properties": {
        "mode": "Incremental",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.1",
          "resources": [          
            {
              "name": "[parameters('todoTasksPlanName')]",
              "type": "Microsoft.Web/serverfarms",
              "location": "[parameters('location')]",
              "apiVersion": "2016-09-01",
              "sku": {
                "name": "F1",
                "tier": "Free",
                "size": "F1",
                "family": "F",
                "capacity": 0
              },
              "kind": "app",
              "properties": {
                "name": "[parameters('todoTasksPlanName')]",
                "perSiteScaling": false,
                "reserved": false,
                "targetWorkerCount": 0,
                "targetWorkerSizeId": 0
              },
              "tags": {
                "displayName": "TodoTasksPlan"
              }
            },
            {
              "apiVersion": "2018-02-01",
              "name": "[parameters('todoTasksAPIName')]",
              "type": "Microsoft.Web/sites",
              "location": "[parameters('location')]",
              "tags": {},
              "dependsOn": [
                "[resourceId('Microsoft.Web/serverfarms/', parameters('todoTasksPlanName'))]"
              ],
              "properties": {
                "name": "[parameters('todoTasksAPIName')]",
                "siteConfig": {
                  "appSettings": [
                    {
                      "name": "ASPNETCORE_ENVIRONMENT",
                      "value": "Development"
                    }
                  ],
                  "alwaysOn": "[parameters('alwaysOn')]",
                  "metadata": [
                    {
                      "name": "CURRENT_STACK",
                      "value": "[parameters('currentStack')]"
                    }
                  ]
                },
                "serverFarmId": "[concat('/subscriptions/', parameters('subscriptionId'),'/resourcegroups/', parameters('resourceGroupName'), '/providers/Microsoft.Web/serverfarms/', parameters('todoTasksPlanName'))]",
                "hostingEnvironment": "[parameters('hostingEnvironment')]",
                "clientAffinityEnabled": true
              }
            }
          ]
        }
      }
    }
  ],
  "outputs": {}
}
